<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Hyperparameters: How to tune my VQ-VAE? - nd_vq_vae</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Hyperparameters: How to tune my VQ-VAE?";
        var mkdocs_page_input_path = "hyperparameter_tuning.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> nd_vq_vae
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">NDimVQVAE Docs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../examples/">Usage</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Hyperparameters: How to tune my VQ-VAE?</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#hyperparameters-overview">Hyperparameters Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tuning-process">Tuning Process</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#monitor-key-metrics">Monitor Key Metrics</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#analyze-loss-curves">Analyze Loss Curves</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#reconstruction-loss">Reconstruction Loss</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#commitment-loss">Commitment Loss</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#balance-losses">Balance Losses</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#optimize-codebook-usage">Optimize Codebook Usage</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fine-tune-learning-dynamics">Fine-tune Learning Dynamics</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#address-overfitting">Address Overfitting</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#attention-mechanism">Attention Mechanism</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#codebook-update-strategy">Codebook Update Strategy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#downsampling-strategy">Downsampling Strategy</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">Install</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">nd_vq_vae</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Hyperparameters: How to tune my VQ-VAE?</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="hyperparameters-how-to-tune-my-vq-vae">Hyperparameters: How to tune my VQ-VAE?</h1>
<h2 id="hyperparameters-overview">Hyperparameters Overview</h2>
<p>The VQ-VAE has several key hyperparameters:</p>
<p>Codebook size and embedding dimension (n_codes and embedding_dim), model capacity (n_hiddens and n_res_layers), downsampling strategy (downsample), loss balancing (codebook_beta and recon_loss_factor), optimization parameters (learning_rate, beta1, beta2), training parameters (batch_size, num_epochs), attention mechanism (n_head, attn_dropout), and codebook update strategy (ema_decay).</p>
<h2 id="tuning-process">Tuning Process</h2>
<h3 id="monitor-key-metrics">Monitor Key Metrics</h3>
<p>During training and validation, it's crucial to track reconstruction loss, commitment loss, and perplexity. Note that the reconstruction loss are in the same units as the input data. Say the input data is in meters, that means that the reconstruction loss will also be in meters!</p>
<h3 id="analyze-loss-curves">Analyze Loss Curves</h3>
<h4 id="reconstruction-loss">Reconstruction Loss</h4>
<p>If the reconstruction loss is high and not decreasing, consider increasing model capacity (n_hiddens, n_res_layers) or adjusting the learning rate. When the training loss is decreasing but validation loss remains stable, it may indicate potential overfitting. In this case, reduce capacity or add regularization. If both training and validation losses are decreasing, but validation loss is much higher, try increasing batch_size or using data augmentation.</p>
<h4 id="commitment-loss">Commitment Loss</h4>
<p>For high commitment loss, decrease codebook_beta. If it's too low or unstable, increase codebook_beta.</p>
<h3 id="balance-losses">Balance Losses</h3>
<p>Adjust codebook_beta and recon_loss_factor to achieve a good balance between reconstruction and commitment losses.</p>
<h3 id="optimize-codebook-usage">Optimize Codebook Usage</h3>
<p>Monitor perplexity closely. Low perplexity suggests increasing n_codes or decreasing embedding_dim, while high perplexity indicates the need to decrease n_codes or increase embedding_dim.</p>
<h3 id="fine-tune-learning-dynamics">Fine-tune Learning Dynamics</h3>
<p>For slow convergence, increase learning_rate or adjust optimizer parameters. If training is unstable, decrease learning_rate or increase batch_size.</p>
<h3 id="address-overfitting">Address Overfitting</h3>
<p>When validation loss plateaus while training loss decreases, consider introducing dropout in encoder/decoder, reducing model capacity, or increasing batch_size / using data augmentation.</p>
<h3 id="attention-mechanism">Attention Mechanism</h3>
<p>Adjust n_head and attn_dropout in attention blocks to improve long-range dependencies.</p>
<h3 id="codebook-update-strategy">Codebook Update Strategy</h3>
<p>Fine-tune ema_decay for optimal codebook stability and adaptation speed.</p>
<h3 id="downsampling-strategy">Downsampling Strategy</h3>
<p>Adjust downsample factors based on available computational resources and required detail level.</p>
<h2 id="best-practices">Best Practices</h2>
<p>Make incremental changes to hyperparameters and perform ablation studies, changing one parameter at a time. Consider using learning rate scheduling or cyclical learning rates. Regularly save checkpoints and log experiments for comparison.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../examples/" class="btn btn-neutral float-left" title="Usage"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../install/" class="btn btn-neutral float-right" title="Install">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../examples/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../install/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
